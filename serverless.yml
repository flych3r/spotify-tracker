service: spotify-tracker

frameworkVersion: '2'

provider:
  name: aws
  lambdaHashingVersion: 20201221
  runtime: python3.8
  region: ${opt:region, 'us-east-1'}
  stage: ${opt:stage, 'dev'}
  profile: ${opt:aws-profile , 'default'}
  environment:
    REGION: ${self:provider.region}
    LOG_LEVEL: ${opt:loglevel, 'INFO'}

custom:
  pythonRequirements:
    layer: true

functions:
  app:
    handler: app.handler
    layers:
      - Ref: PythonRequirementsLambdaLayer
    events:
      - http:
          method: ANY
          path: /
      - http:
          method: ANY
          path: /{proxy+}
    environment:
      APP_ENV: ${opt:stage, 'dev'}
      APP_LAMBDA: true
      SECRET_KEY: ${SECRET_KEY}
      ALGORITHM: ${ALGORITHM}
      ACCESS_TOKEN_EXPIRE_MINUTES: ${ACCESS_TOKEN_EXPIRE_MINUTES}
      CLIENT_ID: ${CLIENT_ID}
      CLIENT_SECRET: ${CLIENT_SECRET}
      OAUTH_AUTHORIZE_URL: ${OAUTH_AUTHORIZE_URL}
      OAUTH_TOKEN_URL: ${OAUTH_TOKEN_URL}
      REDIRECT_URI: ${REDIRECT_URI}
      SCOPE: ${SCOPE}
      B64_CLIENT: ${B64_CLIENT}
      APP_DB_CONNECTOR: ${APP_DB_CONNECTOR}
      APP_DB_USERNAME: ${APP_DB_USERNAME}
      APP_DB_PASSWORD: ${APP_DB_PASSWORD}
      APP_DB_HOST: ${APP_DB_HOST}
      APP_DB_PORT: ${APP_DB_PORT}
      APP_DB_DATABASE: ${APP_DB_DATABASE}

plugins:
  - serverless-python-requirements
  # - serverless-dotenv-plugin

package:
  exclude:
    - node_modules/**
    - venv/**
    - .vscode/**
    - .devcontainer/**
    - notebooks/**
    - .env*
    - Dockerfile
    - Makefile
    - package-lock.json
    - .pre-commit-config.yaml
    - .gitignore
    - .coverage
    - .pytest_cache/**
    - requirements-dev.txt
    - setup.cfg
    - '*.png'
    - '*.egg-info'
